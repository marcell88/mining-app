Telegram-бот для фильтрации и анализа новостей
Этот проект представляет собой Telegram-бот, разработанный для автоматической фильтрации и анализа новостных сообщений с использованием Deepseek API. Бот применяет многоступенчатую систему фильтрации для определения релевантности и художественного потенциала новостей, а также генерирует рекомендации для написания комментариев.

О проекте
Основная цель бота — автоматизировать процесс отбора новостей, исключая нежелательный контент и выделяя сообщения с высоким потенциалом для создания интересного художественного комментария. Это позволяет сосредоточиться на наиболее увлекательных и значимых материалах.

Ключевые особенности
Многоступенчатая фильтрация Deepseek:

Этап 1 (Первичная фильтрация): Отсеивает новости по заданным негативным или нерелевантным темам (трагедии, военные сводки, реклама, ДТП и т.д.), а также проверяет наличие корректной ссылки.

Этап 2 (Контекстная фильтрация): Оценивает полноту контекста новости по критериям (субъект, объект, действие, время/место, причины, следствия и т.д.), чтобы убедиться, что новость содержит достаточно информации.

Этап 3 (Оценка характеристик): Анализирует новость на предмет эмоциональной яркости, образности, юмора, неожиданности и драматичности, присваивая баллы по каждому критерию.

Генерация рекомендаций для комментариев: На основе анализа характеристик Deepseek генерирует художественные рекомендации по написанию комментария к новости, выделяя наиболее интересные аспекты.

Два бота:

Основной бот: Принимает входящие сообщения и, в случае прохождения всех фильтров, пересылает их в приватную группу.

Бот для логирования: Отправляет подробные логи по каждому обработанному сообщению (включая результаты всех этапов фильтрации) в отдельный чат. Также предоставляет статистику по входящим/исходящим сообщениям и возможность сброса счетчиков.

Статистика и управление: Встроенные команды для получения статистики по обработанным сообщениям и сброса счетчиков.

Модульная архитектура: Код разбит на логические модули для улучшения читаемости, поддерживаемости и масштабируемости.

Хранение данных: Использование SQLite для хранения статистики сообщений.

Структура проекта
.
├── config/
│   └── settings.py           # Конфигурация приложения (токены, ID чатов, пороги фильтрации)
├── handlers/
│   ├── __init__.py
│   ├── message_handler.py    # Обработчик входящих сообщений (координация фильтров и отправки)
│   └── commands_handler.py   # Обработчик команд /stats и /zero
├── services/
│   ├── __init__.py
│   ├── database_service.py   # Сервис для работы с SQLite базой данных (статистика)
│   ├── deepseek_service.py   # Сервис для взаимодействия с Deepseek API (сырые запросы)
│   ├── deepseek_processor.py # Логика обработки данных через Deepseek (этапы фильтрации, генерация рекомендаций)
│   └── telegram_logger.py    # Сервис для отправки логов в отдельный Telegram-бот
├── data/
│   └── stats.db              # База данных SQLite для статистики
├── prompts.py                # Все текстовые промпты для Deepseek API
├── main_bot_app.py           # Точка входа для основного Telegram-бота
├── logging_bot_app.py        # Точка входа для Telegram-бота логирования
└── README.md                 # Этот файл

Установка и запуск
Требования
Python 3.9+

Активные аккаунты Telegram и Deepseek API.

1. Клонирование репозитория
git clone <URL_ВАШЕГО_РЕПОЗИТОРИЯ>
cd mining-app

2. Создание виртуального окружения и установка зависимостей
python3 -m venv venv
source venv/bin/activate  # Для Linux/macOS
# venv\Scripts\activate   # Для Windows
pip install -r requirements.txt

Содержимое requirements.txt:

python-telegram-bot==21.2
requests
python-dotenv

3. Настройка переменных окружения
Создайте файл .env в корневой директории проекта со следующими переменными:

TELEGRAM_BOT_TOKEN="ВАШ_ТОКЕН_ОСНОВНОГО_БОТА"
PRIVATE_GROUP_CHAT_ID="-100XXXXXXXXXXXXXXXX" # ID вашей приватной группы (начинается с -100)

LOGGING_BOT_TOKEN="ВАШ_ТОКЕН_ЛОГИРУЮЩЕГО_БОТА"
LOGGING_CHAT_ID="-100YYYYYYYYYYYYYYYYY" # ID чата для логирования (может быть тот же, что и PRIVATE_GROUP_CHAT_ID, или другой)

DEEPSEEK_API_KEY="ВАШ_DEEPSEEK_API_KEY"

# Пороги для фильтрации (можно настроить)
CONTEXT_THRESHOLD=40
MAX_POTENTIAL=8
SUM_POTENTIAL=25

Как получить Chat ID приватной группы/чата:
Перешлите любое сообщение из вашей приватной группы/чата боту @userinfobot или @getidsbot. Он пришлет вам ID чата, который будет начинаться с -100.

4. Запуск ботов
Для полноценной работы системы необходимо запустить два отдельных процесса: основной бот и бот для логирования.

В первом терминале (для основного бота):

source venv/bin/activate # Активируйте виртуальное окружение, если еще не активировали
python3 main_bot_app.py

Во втором терминале (для бота логирования):

source venv/bin/activate # Активируйте виртуальное окружение, если еще не активировали
python3 logging_bot_app.py

Оба бота должны успешно инициализироваться и начать прослушивание сообщений.

Использование
Для основного бота:
Отправляйте текстовые сообщения в основной бот. Если сообщение содержит ссылку, отделите ее от основного текста 1111\n\n.

Пример формата сообщения:

Основной текст новости здесь.
1111

Ссылка на источник новости здесь.

Бот обработает сообщение через Deepseek API:

Первичная фильтрация: Определит, является ли новость релевантной и допустимой.

Контекстная фильтрация: Оценит полноту информации в новости.

Оценка характеристик: Проанализирует новость на эмоциональность, образность, юмор, неожиданность и драматичность.

Если новость пройдет все фильтры, она будет переслана в вашу приватную группу с суммарным потенциалом и рекомендациями для комментария.

Для бота логирования:
Отправляйте команды в бот для логирования:

/stats - Получить текущую статистику по входящим и исходящим сообщениям.

/zero - Сбросить счетчики статистики до нуля.

Дальнейшее развитие
Расширение промптов: Уточнение и детализация промптов для Deepseek для более точной фильтрации и анализа.

Добавление новых характеристик: Включение дополнительных критериев оценки новостей.

Интеграция с Google Sheets: Автоматическая запись результатов анализа в Google Sheet для более удобного отслеживания и анализа данных.

Асинхронные запросы к Deepseek: Переход на aiohttp или аналогичные библиотеки для асинхронных HTTP-запросов, чтобы избежать блокировки цикла событий при долгих ответах от Deepseek.

Уведомления об ошибках: Расширенная система уведомлений об ошибках для разработчика.

Веб-интерфейс: Создание простого веб-интерфейса для управления ботом и просмотра статистики.